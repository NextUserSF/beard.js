(function(t){"use strict";function e(t){return"function"==typeof t}function i(t){return t&&"object"==typeof t?"[object Array]"===toString.call(t):!1}var s;s=function(e,i,s){this.tpl=e||"",this.data=i||{},this.UDEF=t,this.elements=s||{}},s.prototype={set:function(t){return this.tpl=t||"",this},get:function(){return this.tpl},render:function(t){t&&(this.data=t);var e=s.compile(this.tpl);return e(this.data,this.elements)},getRequired:function(t){return t=t||this.tpl,s.getRequired(t)},addElements:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this.elements[e]=t[e]);return this},addElement:function(t,e){return this.elements[t]=e,this},remElement:function(t){return delete this.elements[t],this},remElements:function(){return this.elements={},this},addVariable:function(t,e){return this.data[t]=e,this},remVariable:function(t){return delete this.data[t],this},resetDataObject:function(){return this.data={},this}};var n=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,statement:6,openBlock:7,program:8,closeBlock:9,inlineTag:10,elementTag:11,dataTag:12,CONTENT:13,COMMENT:14,OPEN:15,ID:16,args:17,CLOSE:18,hash:19,OPEN_INLINE:20,segments:21,SEP:22,hashSegment:23,data:24,compOperator:25,EQUALS:26,GREATER:27,LESSER:28,AND:29,OR:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,simpleInverse:35,OPEN_INVERSE:36,END_BLOCK:37,OPEN_ELEMENT:38,OPEN_VARIABLE:39,"var":40,func:41,ALT:42,funcArgs:43,OP:44,CP:45,COMMA:46,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",13:"CONTENT",14:"COMMENT",15:"OPEN",16:"ID",18:"CLOSE",20:"OPEN_INLINE",22:"SEP",26:"EQUALS",27:"GREATER",28:"LESSER",29:"AND",30:"OR",32:"STRING",33:"INTEGER",34:"BOOLEAN",36:"OPEN_INVERSE",37:"END_BLOCK",38:"OPEN_ELEMENT",39:"OPEN_VARIABLE",42:"ALT",44:"OP",45:"CP",46:"COMMA"},productions_:[0,[3,2],[4,1],[4,2],[6,3],[6,1],[6,1],[6,1],[6,1],[6,1],[7,4],[7,4],[10,4],[10,4],[21,3],[21,1],[19,1],[23,3],[25,1],[25,1],[25,1],[25,1],[25,1],[31,1],[31,1],[31,1],[8,2],[8,3],[8,2],[8,1],[8,1],[8,0],[35,2],[9,1],[11,3],[12,3],[24,1],[24,1],[24,1],[40,1],[40,3],[40,3],[40,5],[41,2],[41,4],[41,4],[41,6],[43,3],[17,3],[17,1],[17,0]],performAction:function(t,e,i,s,n,r){var o=r.length-1;switch(n){case 1:return new s.ProgramNode(r[o-1]);case 2:this.$=[r[o]];break;case 3:r[o-1].push(r[o]),this.$=r[o-1];break;case 4:this.$=new s.BlockNode(r[o-2],r[o-1],r[o]);break;case 5:this.$=new s.InlineNode(r[o]);break;case 6:this.$=new s.ElementNode(r[o]);break;case 7:this.$=new s.DataNode(r[o]);break;case 8:this.$=new s.ContentNode(r[o]);break;case 9:this.$=new s.CommentNode(r[o]);break;case 10:this.$=[r[o-2],r[o-1]];break;case 11:this.$=[r[o-2],[r[o-1]]];break;case 12:this.$=[r[o-2],r[o-1]];break;case 13:this.$=[r[o-2],[r[o-1]]];break;case 14:r[o-2].push(r[o]),this.$=r[o-2];break;case 15:this.$=[r[o]];break;case 16:this.$=new s.HashNode(r[o]);break;case 17:this.$=[r[o-2],r[o-1],r[o]];break;case 23:this.$=new s.StringNode(r[o]);break;case 24:this.$=new s.IntegerNode(r[o]);break;case 25:this.$=new s.BooleanNode(r[o]);break;case 26:this.$=new s.ProgramNode([],r[o]);break;case 27:this.$=new s.ProgramNode(r[o-2],r[o]);break;case 28:this.$=new s.ProgramNode(r[o-1],[]);break;case 29:this.$=new s.ProgramNode(r[o]);break;case 30:this.$=new s.ProgramNode([]);break;case 31:this.$=new s.ProgramNode([]);break;case 33:this.$=r[o];break;case 34:this.$=r[o-1];break;case 35:this.$=r[o-1];break;case 36:this.$=r[o];break;case 37:this.$=r[o];break;case 38:this.$=r[o];break;case 39:this.$=new s.VariableNode(r[o]);break;case 40:this.$=new s.VariableNode(r[o-2],r[o]);break;case 41:this.$=new s.VariableNode([r[o-2]].concat(r[o]));break;case 42:this.$=new s.VariableNode([r[o-4]].concat(r[o-2]),r[o]);break;case 43:this.$=new s.FuncNode(r[o-1],r[o]);break;case 44:this.$=new s.FuncNode(r[o-3],r[o-2],r[o]);break;case 45:this.$=new s.FuncNode([r[o-3]].concat(r[o-1]),r[o]);break;case 46:this.$=new s.FuncNode([r[o-5]].concat(r[o-3]),r[o-2],r[o]);break;case 47:this.$=r[o-1];break;case 48:r[o-2].push(r[o]),this.$=r[o-2];break;case 49:this.$=[r[o]];break;case 50:this.$=[]}},table:[{3:1,4:2,6:3,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],38:[1,12],39:[1,13]},{1:[3]},{5:[1,14],6:15,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],38:[1,12],39:[1,13]},{5:[2,2],13:[2,2],14:[2,2],15:[2,2],20:[2,2],36:[2,2],37:[2,2],38:[2,2],39:[2,2]},{4:18,6:3,7:4,8:16,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],35:17,36:[1,19],37:[2,31],38:[1,12],39:[1,13]},{5:[2,5],13:[2,5],14:[2,5],15:[2,5],20:[2,5],36:[2,5],37:[2,5],38:[2,5],39:[2,5]},{5:[2,6],13:[2,6],14:[2,6],15:[2,6],20:[2,6],36:[2,6],37:[2,6],38:[2,6],39:[2,6]},{5:[2,7],13:[2,7],14:[2,7],15:[2,7],20:[2,7],36:[2,7],37:[2,7],38:[2,7],39:[2,7]},{5:[2,8],13:[2,8],14:[2,8],15:[2,8],20:[2,8],36:[2,8],37:[2,8],38:[2,8],39:[2,8]},{5:[2,9],13:[2,9],14:[2,9],15:[2,9],20:[2,9],36:[2,9],37:[2,9],38:[2,9],39:[2,9]},{16:[1,20]},{16:[1,21]},{16:[1,22]},{16:[1,31],21:27,24:23,31:26,32:[1,28],33:[1,29],34:[1,30],40:24,41:25},{1:[2,1]},{5:[2,3],13:[2,3],14:[2,3],15:[2,3],20:[2,3],36:[2,3],37:[2,3],38:[2,3],39:[2,3]},{9:32,37:[1,33]},{4:34,6:3,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],37:[2,30],38:[1,12],39:[1,13]},{6:15,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],35:35,36:[1,19],37:[2,29],38:[1,12],39:[1,13]},{18:[1,36]},{16:[1,31],17:37,18:[2,50],19:38,21:27,23:40,24:39,31:26,32:[1,28],33:[1,29],34:[1,30],40:24,41:25,46:[2,50]},{16:[1,31],17:41,18:[2,50],19:42,21:27,23:40,24:39,31:26,32:[1,28],33:[1,29],34:[1,30],40:24,41:25,46:[2,50]},{18:[1,43]},{18:[1,44]},{18:[2,36],26:[2,36],27:[2,36],28:[2,36],29:[2,36],30:[2,36],45:[2,36],46:[2,36]},{18:[2,37],22:[1,45],26:[2,37],27:[2,37],28:[2,37],29:[2,37],30:[2,37],45:[2,37],46:[2,37]},{18:[2,38],26:[2,38],27:[2,38],28:[2,38],29:[2,38],30:[2,38],45:[2,38],46:[2,38]},{18:[2,39],22:[1,48],26:[2,39],27:[2,39],28:[2,39],29:[2,39],30:[2,39],42:[1,46],43:47,44:[1,49],45:[2,39],46:[2,39]},{18:[2,23],22:[2,23],26:[2,23],27:[2,23],28:[2,23],29:[2,23],30:[2,23],45:[2,23],46:[2,23]},{18:[2,24],22:[2,24],26:[2,24],27:[2,24],28:[2,24],29:[2,24],30:[2,24],45:[2,24],46:[2,24]},{18:[2,25],22:[2,25],26:[2,25],27:[2,25],28:[2,25],29:[2,25],30:[2,25],45:[2,25],46:[2,25]},{18:[2,15],22:[2,15],26:[2,15],27:[2,15],28:[2,15],29:[2,15],30:[2,15],42:[2,15],44:[2,15],45:[2,15],46:[2,15]},{5:[2,4],13:[2,4],14:[2,4],15:[2,4],20:[2,4],36:[2,4],37:[2,4],38:[2,4],39:[2,4]},{5:[2,33],13:[2,33],14:[2,33],15:[2,33],20:[2,33],36:[2,33],37:[2,33],38:[2,33],39:[2,33]},{6:15,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],37:[2,26],38:[1,12],39:[1,13]},{4:50,6:3,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],37:[2,28],38:[1,12],39:[1,13]},{13:[2,32],14:[2,32],15:[2,32],20:[2,32],37:[2,32],38:[2,32],39:[2,32]},{18:[1,51],46:[1,52]},{18:[1,53]},{18:[2,49],25:54,26:[1,55],27:[1,56],28:[1,57],29:[1,58],30:[1,59],46:[2,49]},{18:[2,16]},{18:[1,60],46:[1,52]},{18:[1,61]},{5:[2,34],13:[2,34],14:[2,34],15:[2,34],20:[2,34],36:[2,34],37:[2,34],38:[2,34],39:[2,34]},{5:[2,35],13:[2,35],14:[2,35],15:[2,35],20:[2,35],36:[2,35],37:[2,35],38:[2,35],39:[2,35]},{16:[1,31],21:62},{31:63,32:[1,28],33:[1,29],34:[1,30]},{18:[2,43],22:[2,43],26:[2,43],27:[2,43],28:[2,43],29:[2,43],30:[2,43],42:[1,64],45:[2,43],46:[2,43]},{16:[1,65]},{16:[1,31],17:66,21:27,24:67,31:26,32:[1,28],33:[1,29],34:[1,30],40:24,41:25,45:[2,50],46:[2,50]},{6:15,7:4,10:5,11:6,12:7,13:[1,8],14:[1,9],15:[1,10],20:[1,11],37:[2,27],38:[1,12],39:[1,13]},{13:[2,10],14:[2,10],15:[2,10],20:[2,10],36:[2,10],37:[2,10],38:[2,10],39:[2,10]},{16:[1,31],21:27,24:68,31:26,32:[1,28],33:[1,29],34:[1,30],40:24,41:25},{13:[2,11],14:[2,11],15:[2,11],20:[2,11],36:[2,11],37:[2,11],38:[2,11],39:[2,11]},{16:[1,31],21:27,24:69,31:26,32:[1,28],33:[1,29],34:[1,30],40:24,41:25},{16:[2,18],32:[2,18],33:[2,18],34:[2,18]},{16:[2,19],32:[2,19],33:[2,19],34:[2,19]},{16:[2,20],32:[2,20],33:[2,20],34:[2,20]},{16:[2,21],32:[2,21],33:[2,21],34:[2,21]},{16:[2,22],32:[2,22],33:[2,22],34:[2,22]},{5:[2,12],13:[2,12],14:[2,12],15:[2,12],20:[2,12],36:[2,12],37:[2,12],38:[2,12],39:[2,12]},{5:[2,13],13:[2,13],14:[2,13],15:[2,13],20:[2,13],36:[2,13],37:[2,13],38:[2,13],39:[2,13]},{18:[2,41],22:[1,48],26:[2,41],27:[2,41],28:[2,41],29:[2,41],30:[2,41],42:[1,70],43:71,44:[1,49],45:[2,41],46:[2,41]},{18:[2,40],26:[2,40],27:[2,40],28:[2,40],29:[2,40],30:[2,40],45:[2,40],46:[2,40]},{31:72,32:[1,28],33:[1,29],34:[1,30]},{18:[2,14],22:[2,14],26:[2,14],27:[2,14],28:[2,14],29:[2,14],30:[2,14],42:[2,14],44:[2,14],45:[2,14],46:[2,14]},{45:[1,73],46:[1,52]},{45:[2,49],46:[2,49]},{18:[2,48],45:[2,48],46:[2,48]},{18:[2,17]},{31:74,32:[1,28],33:[1,29],34:[1,30]},{18:[2,45],22:[2,45],26:[2,45],27:[2,45],28:[2,45],29:[2,45],30:[2,45],42:[1,75],45:[2,45],46:[2,45]},{18:[2,44],22:[2,44],26:[2,44],27:[2,44],28:[2,44],29:[2,44],30:[2,44],45:[2,44],46:[2,44]},{18:[2,47],22:[2,47],26:[2,47],27:[2,47],28:[2,47],29:[2,47],30:[2,47],42:[2,47],45:[2,47],46:[2,47]},{18:[2,42],26:[2,42],27:[2,42],28:[2,42],29:[2,42],30:[2,42],45:[2,42],46:[2,42]},{31:76,32:[1,28],33:[1,29],34:[1,30]},{18:[2,46],22:[2,46],26:[2,46],27:[2,46],28:[2,46],29:[2,46],30:[2,46],45:[2,46],46:[2,46]}],defaultActions:{14:[2,1],40:[2,16],69:[2,17]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){function e(){var t;return t=i.lexer.lex()||p,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,s=[0],n=[null],r=[],o=this.table,h="",a=0,c=0,l=0,u=2,p=1,f=r.slice.call(arguments,1);this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var g=this.lexer.yylloc;r.push(g);var d=this.lexer.options&&this.lexer.options.ranges;this.parseError="function"==typeof this.yy.parseError?this.yy.parseError:Object.getPrototypeOf(this).parseError;for(var m,y,k,S,v,b,E,x,_,N={};;){if(k=s[s.length-1],this.defaultActions[k]?S=this.defaultActions[k]:((null===m||"undefined"==typeof m)&&(m=e()),S=o[k]&&o[k][m]),"undefined"==typeof S||!S.length||!S[0]){var A="";_=[];for(b in o[k])this.terminals_[b]&&b>u&&_.push("'"+this.terminals_[b]+"'");A=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(a+1)+": Unexpected "+(m==p?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(A,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:g,expected:_})}if(S[0]instanceof Array&&S.length>1)throw new Error("Parse Error: multiple actions possible at state: "+k+", token: "+m);switch(S[0]){case 1:s.push(m),n.push(this.lexer.yytext),r.push(this.lexer.yylloc),s.push(S[1]),m=null,y?(m=y,y=null):(c=this.lexer.yyleng,h=this.lexer.yytext,a=this.lexer.yylineno,g=this.lexer.yylloc,l>0&&l--);break;case 2:if(E=this.productions_[S[1]][1],N.$=n[n.length-E],N._$={first_line:r[r.length-(E||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(E||1)].first_column,last_column:r[r.length-1].last_column},d&&(N._$.range=[r[r.length-(E||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.apply(N,[h,c,a,this.yy,S[1],n,r].concat(f)),"undefined"!=typeof v)return v;E&&(s=s.slice(0,2*-1*E),n=n.slice(0,-1*E),r=r.slice(0,-1*E)),s.push(this.productions_[S[1]][0]),n.push(N.$),r.push(N._$),x=o[s[s.length-2]][s[s.length-1]],s.push(x);break;case 3:return!0}}return!0}},i=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var s=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===s.length?this.yylloc.first_column:0)+s[s.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,s,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var r in n)this[r]=n[r];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,s;this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if(i=this._input.match(this.rules[n[r]]),i&&(!e||i[0].length>e[0].length)){if(e=i,s=r,this.options.backtrack_lexer){if(t=this.test_match(i,n[r]),t!==!1)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,n[s]),t!==!1?t:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,s){function n(t,i){return e.yytext=e.yytext.substr(t,e.yyleng-i)}switch(i){case 0:if(this.begin("beard"),e.yytext)return 13;break;case 1:return 13;case 2:return n(0,2),this.popState(),14;case 3:return 39;case 4:return 38;case 5:return 20;case 6:this.popState(),this.begin("com");break;case 7:return n(3,5),this.popState(),14;case 8:return n(6,9),this.popState(),37;case 9:return 36;case 10:return 15;case 11:return 30;case 12:return 42;case 13:return 22;case 14:return 46;case 15:return 44;case 16:return 45;case 17:return 26;case 18:return 27;case 19:return 28;case 20:return 29;case 21:break;case 22:return this.popState(),18;case 23:return e.yytext=n(1,2).replace(/\\"/g,'"'),32;case 24:return e.yytext=n(1,2).replace(/\\'/g,"'"),32;case 25:return 33;case 26:return 34;case 27:return 34;case 28:return 16;case 29:return"INVALID";case 30:return 5}},rules:[/^(?:[^\x00]*?(?=(<%)))/,/^(?:[^\x00]+)/,/^(?:[\s\S]*?%>)/,/^(?:<%=)/,/^(?:<%@)/,/^(?:<%~)/,/^(?:<%#)/,/^(?:<%#[\s\S]*?%>)/,/^(?:<% end([a-zA-Z_][a-zA-Z0-9_]*) %>)/,/^(?:<%\s*else\b)/,/^(?:<%)/,/^(?:\|\|)/,/^(?:\|)/,/^(?:\.)/,/^(?:,)/,/^(?:\()/,/^(?:\))/,/^(?:===|==|=)/,/^(?:>)/,/^(?:<)/,/^(?:&&)/,/^(?:\s+)/,/^(?:%>)/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:-?[0-9]+)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:([a-zA-Z_][a-zA-Z0-9_]*))/,/^(?:.)/,/^(?:$)/],conditions:{beard:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!1},com:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,30],inclusive:!0}}};return t}();return e.lexer=i,t.prototype=e,e.Parser=t,new t}();s.Parser=n,s.AST={},s.AST.ProgramNode=function(t,e){this.type="program",this.statements=t,e&&(this.inverse=new s.AST.ProgramNode(e))},s.AST.ElementNode=function(t){this.type="element",this.id=t},s.AST.ContentNode=function(t){this.type="content",this.string=t},s.AST.DataNode=function(t){this.type="data",this.data=t},s.AST.VariableNode=function(t,e){this.type="variable",this.parts=t,this.string=t.join("."),this.def=e||"",this.isSimple=1===t.length},s.AST.FuncNode=function(t,e,i){this.type="func",this.parts=t,this.string=t.join("."),this.args=e,this.def=i||""},s.AST.CommentNode=function(t){this.type="comment",this.comment=t},s.AST.IdNode=function(t){this.type="ID",this.id=t},s.AST.BlockNode=function(t,e,i){if(t[0]!==i)throw new Error(t[0]+" doesn't match "+i);this.type="block",this.helper=t[0],this.args=t[1],this.program=e},s.AST.InlineNode=function(t){this.type="inline",this.helper=t[0],this.args=t[1]},s.AST.StringNode=function(t){this.type="STRING",this.string=this.stringModeValue=t},s.AST.IntegerNode=function(t){this.type="INTEGER",this.integer=t,this.stringModeValue=Number(t)},s.AST.BooleanNode=function(t){this.type="BOOLEAN",this.bool=t,this.stringModeValue="true"===t},s.AST.HashNode=function(t){this.type="hash",this.pairs=t};var r=s.Compiler=function(){};r.prototype={compiler:r,guid:0,equals:function(t){var e,i,s=this.opcodes.length,n=0,r=0;if(t.opcodes.length!==s)return!1;for(;s>n;n+=1){if(e=this.opcodes[n],i=t.opcodes[n],e.opcode!==i.opcode||e.args.length!==i.args.length)return!1;for(;r<e.args.length;r+=1)if(e.args[r]!==i.args[r])return!1}if(s=this.children.length,t.children.length!==s)return!1;for(n=0;s>n;n+=1)if(!this.children[n].equals(t.children[n]))return!1;return!0},compile:function(t,e){this.children=[],this.depths={list:[]},this.options=e;var i=this.options.knownHelpers;if(this.options.knownHelpers={foreach:!0,"if":!0},i)for(var s in i)this.options.knownHelpers[s]=i[s];return this.program(t)},program:function(t){var e,i=t.statements,s=0,n=i.length;for(this.opcodes=[],s;n>s;s+=1)e=i[s],this[e.type](e);return this.isSimple=1===n,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e=(new this.compiler).compile(t,this.options),i=this.guid++;return this.useElement=this.useElement||e.useElement,this.children[i]=e,i},element:function(t){this.useElement=!0,this.opcode("push","depth0"),this.opcode("invokeElement",t.id),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},data:function(t){this[t.data.type](t.data),this.opcode("append")},variable:function(t){var e=t.parts[0],i=1,s=t.parts.length;for(e?"object"==typeof t.parts[0]?this[t.parts[0].type](t.parts[0]):this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");s>i;i+=1)"object"==typeof t.parts[i]?this[t.parts[i].type](t.parts[i]):this.opcode("lookup",t.parts[i]);t.def&&(this[t.def.type](t.def),this.opcode("fallback"))},func:function(t){var e=t.parts[0],i=1,n=t.parts.length;for(e?"object"==typeof t.parts[0]?this[t.parts[0].type](t.parts[0]):this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");n>i;i+=1)"object"==typeof t.parts[i]?this[t.parts[i].type](t.parts[i]):this.opcode("lookup",t.parts[i]);s.Utils.isEmpty(t.args)?this.opcode("pushArgs",0):(this.args(t.args),this.opcode("pushArgs",t.args.length)),this.opcode("funcCall"),t.def&&(this[t.def.type](t.def),this.opcode("fallback"))},args:function(t){for(var e,i=0,s=t.length;s>i;i+=1)e=t[i],this[e.type](e)},comment:function(){},block:function(t){var e=t.helper,i=t.args||[],s=t.program,n=s.inverse;s=this.compileProgram(s),n&&(n=this.compileProgram(n)),this.opcode("pushProgram",s),this.opcode("pushProgram",n),i.length&&this.args(i),this.opcode("pushArgs",i.length),this.options.knownHelpers[e]?this.opcode("invokeKnownHelper",e,!0):this.opcode("invokeHelper",e,!0),this.opcode("append")},inline:function(t){var e=t.helper,i=t.args;i.length&&this.args(i),this.opcode("pushArgs",i.length),this.options.knownHelpers[e]?this.opcode("invokeKnownHelper",e):this.opcode("invokeHelper",e),this.opcode("append")},hash:function(t){for(var e,i=0,s=t.pairs.length;s>i;i+=1)e=t.pairs[i],"string"!=typeof e?this[e.type](e):this.opcode("pushLiteral",e);this.opcode("pushHash",s)},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("pushLiteral",t.integer)},BOOLEAN:function(t){this.opcode("pushLiteral",t.bool)},opcode:function(t){this.opcodes.push({opcode:t,args:[].slice.call(arguments,1)})}},s.compile=function(e,i){function n(){var n=s.parse(e),o=(new r).compile(n,i),h=(new s.JSCompiler).compile(o,i,t,!0);return s.template(h)}if(null==e||"string"!=typeof e&&e.constructor!==s.AST.ProgramNode)throw new Error("You must pass a string or Beard AST to Beard.compile. You passed "+e);i=i||{};var o;return function(t,e){return o||(o=n()),o.call(this,t,e)}};var o=function(t){this.value=t},h=s.JSCompiler=function(){};h.prototype={namespace:"Beard",nameLookup:function(t,e){return/^[0-9]+$/.test(e)?t+"["+e+"]":h.isValidVarName(e)?t+"."+e:t+"['"+e+"']"},appendToBuffer:function(t){return this.env.isSimple?"return "+t+";":{appendToBuffer:!0,content:t,toString:function(){return"buffer += "+t+";"}}},initializeBuffer:function(){return this.quotedString("")},compile:function(t,e,i,s){this.env=t,this.options=e||{},this.name=this.env.name,this.isChild=!!i,this.context=i||{programs:[],envs:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.i=0,this.compileStack=[],this.inlineStack=[],this.compileChildren(t,e);for(var n,r=t.opcodes,o=r.length;this.i<o;this.i+=1)n=r[this.i],this[n.opcode].apply(this,n.args);return this.createFunctionContext(s)},preamble:function(){var t=[];if(this.isChild)t.push("");else{var e=this.namespace,i="helpers = this.merge(helpers, "+e+".helpers);";t.push(i)}this.env.isSimple?t.push(""):t.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(t){if(!this.isChild)for(var e in this.context.aliases)this.context.aliases.hasOwnProperty(e)&&(this.source[1]=this.source[1]+", "+e+"="+this.context.aliases[e]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.env.isSimple||this.source.push("return buffer;");for(var i=this.isChild?["depth0","data"]:["Beard","depth0","helpers","elements","data"],s=0,n=this.env.depths.list.length;n>s;s++)i.push("depth"+this.env.depths.list[s]);var r=this.mergeSource();if(t)return i.push(r),Function.apply(this,i);var o="function "+(this.name||"")+"("+i.join(",")+") {\n  "+r+"}";return o},appendContent:function(t){this.source.push(this.appendToBuffer(this.quotedString(t)))},pushString:function(t){this.pushStackLiteral(this.quotedString(t))},push:function(t){return this.inlineStack.push(t),t},pushLiteral:function(t){this.pushStackLiteral(t)},invokeElement:function(t){var e=[this.nameLookup("elements",t,"element"),"depth0","elements"];this.push("this.invokeElement("+e.join(", ")+")")},invokeKnownHelper:function(t,e){var i=this.setupHelper(t,!1,e);this.push(i.name+".call("+i.callArgs+")")},invokeHelper:function(t,e){var i=this.setupHelper(t,!0,e);this.context.aliases.helperMissing="helpers.helperMissing",this.push(i.name+" ? "+i.name+".call("+i.callArgs+") : helperMissing.call("+i.helperMissingArgs+")")},setupHelper:function(t,e,i){var s=[],n=this.nameLookup("helpers",t,"helper");return this.setupArgs(s,i),{args:s,name:n,callArgs:["depth0"].concat(s).join(", "),helperMissingArgs:e&&["depth0",this.quotedString(t)].concat(s).join(", ")}},setupArgs:function(t,e){var i,s,n,r=[];return i=this.popStack(),e&&(s=this.popStack(),n=this.popStack(),(n||s)&&(n||(this.context.aliases.self="this",n="self.noop"),s||(this.context.aliases.self="this",s="self.noop"),r.push("inverse:"+s),r.push("fn:"+n))),t.push(i),r="{"+r.join(",")+"}",t.push(r),t.join(", ")},append:function(){this.flushInline();var t=this.popStack();this.source.push("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.env.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},lookupOnContext:function(t){this.push(this.nameLookup("depth"+this.lastContext,t,"context"))},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},fallback:function(){this.flushInline();var t=this.topStackName(),e=this.popStack();this.source.push("if (!"+t+" && "+t+" !== 0) { "+t+" = "+e+"; }")},funcCall:function(){this.flushInline();var t=this.popStack(),e=this.topStackName();this.source.push("if (typeof "+e+' === "function") { '+e+" = "+e+".apply(depth0, "+t+"); }")},pushArgs:function(t){this.flushInline();for(var e,i=0,s=[];t>i;i+=1)e=this.popStack(),s.unshift(e);this.push("["+s.join(",")+"]")},pushHash:function(t){this.flushInline();for(var e,i=0,s=[];t>i;i+=1)e=this.popStack(),s.unshift(e);this.push("("+s.join(" ")+")")},pushProgram:function(t){null!=t?this.pushStackLiteral(this.programExpression(t)):this.pushStackLiteral(null)},programExpression:function(t){if(this.context.aliases.self="this",null==t)return"self.noop";for(var e,i=this.env.children[t],s=i.depths.list,n=[i.index,i.name,"data"],r=0;r<s.length;r+=1)e=s[r],1===e?n.push("depth0"):n.push("depth"+(e-1));return(0===s.length?"self.program(":"self.programWithDepth(")+n.join(", ")+")"},replaceStack:function(t){var e,i="",s=this.isInline();if(s){var n=this.popStack(!0);if(n instanceof o)e=n.value;else{var r=this.stackSlot?this.topStackName():this.incrStack();i="("+this.push(r)+" = "+n+"),",e=this.topStack()}}else e=this.topStack();var h=t.call(this,e);return s?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+i+h+")")):(/stack/.test(e)||(e=this.nextStack()),this.source.push(e+" = ("+i+h+");")),e},flushInline:function(){var t,e=this.inlineStack,i=0,s=e.length;if(s)for(this.inlineStack=[];s>i;i+=1)t=e[i],t instanceof o?this.compileStack.push(t):this.pushStack(t)},popStack:function(t){var e=this.isInline(),i=(e?this.inlineStack:this.compileStack).pop();return!t&&i instanceof o?i.value:(e||this.stackSlot--,i)},isInline:function(){return this.inlineStack.length},topStack:function(t){var e=this.isInline()?this.inlineStack:this.compileStack,i=e[e.length-1];return!t&&i instanceof o?i.value:i},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},mergeSource:function(){for(var e,i,s="",n=0,r=this.source.length;r>n;n+=1)i=this.source[n],i.appendToBuffer?e=e?e+"\n    + "+i.content:i.content:(e&&(s+="buffer += "+e+";\n  ",e=t),s+=i+"\n  ");return s},pushStackLiteral:function(t){return this.push(new o(t))},pushStack:function(t){this.flushInline();var e=this.incrStack();return t&&this.source.push(e+"="+t+";"),this.compileStack.push(e),e},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},compiler:h,compileChildren:function(t,e){for(var i,s,n=t.children,r=0,o=n.length;o>r;r+=1){i=n[r],s=new this.compiler;var h=this.matchExistingProgram(i);null==h?(this.context.programs.push(""),h=this.context.programs.length,i.index=h,i.name="program"+h,this.context.programs[h]=s.compile(i,e,this.context),this.context.envs[h]=i):(i.index=h,i.name="program"+h)}},matchExistingProgram:function(t){for(var e,i=0,s=this.context.envs.length;s>i;i+=1)if(e=this.context.envs[i],e&&e.equals(t))return i}};for(var a="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),c=h.RESERVED_WORDS={},l=0,u=a.length;u>l;l++)c[a[l]]=!0;h.isValidVarName=function(t){return!h.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(t)?!0:!1},s.VM={template:function(t){var e={escapeExpression:s.Utils.escapeExpression,invokeElement:s.VM.invokeElement,programs:[],program:function(t,e,i){var n=this.programs[t];return i?n=s.VM.program(t,e,i):n||(n=this.programs[t]=s.VM.program(t,e)),n},merge:function(t,e){var i=t||e;return t&&e&&t!==e&&(i={},s.Utils.extend(i,e),s.Utils.extend(i,t)),i},programWithDepth:s.VM.programWithDepth,noop:s.VM.noop};return function(i,n){var r=t.call(e,s,i,s.helpers,n);return r}},programWithDepth:function(t,e,i){var s=Array.protorype.slice.call(arguments,3),n=function(t,n){return n=n||{},e.apply(this,[t,n.data||i].concat(s))};return n.program=t,n.depth=s.length,n},program:function(t,e,i){var s=function(t,s){return s=s||{},e(t,s.data||i)};return s.program=t,s.depth=0,s},noop:function(){return""},invokeElement:function(t,e,i){var n=s.compile(t);return n(e,i)}},s.template=s.VM.template,s.helpers={},s.registerHelper=function(t,e){this.helpers[t]=e},s.registerHelper("foreach",function(t,e){var s=e.fn,n=0,r="",o={};if(t=t[0],t&&"object"==typeof t)if(i(t))for(var h=t.length;h>n;n++)o={key:n,value:t[n]},r+=s(o);else for(var a in t)t.hasOwnProperty(a)&&(o={key:a,value:t[a]},r+=s(o));else if(t)throw new Error("Data should be either Object or Array");return r}),s.registerHelper("if",function(t,i){return t=t[0],e(t)&&(t=t.call(this)),s.Utils.isEmpty(t)||0===t?i.inverse(this):i.fn(this)}),s.registerHelper("helperMissing",function(t){throw new Error('Missing helper: "'+t+'"')}),e(/x/)&&(e=function(t){return"function"==typeof t&&"[object Function]"===toString.call(t)}),s.SafeString=function(t){this.string=t},s.SafeString.prototype.toString=function(){return""+this.string};var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27","`":"&#x60"},f=/[&<>"'`]/g,g=/[&<>"'`]/,d=function(t){return p[t]||"&amp;"};s.Utils={extend:function(t,e){var i;for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},escapeExpression:function(t){return t instanceof s.SafeString?t.toString():t||0===t?(t=""+t,g.test(t)?t.replace(f,d):t):""
},isEmpty:function(t){return t||0===t?i(t)&&0===t.length?!0:!1:!0}},s.parse=function(t){return s.Parser.yy=s.AST,s.Parser.parse(t)},s.getRequired=function(t){var e=s.parse(t);return e.statements.reduce(function(t,e){switch(e.constructor){case s.AST.DataNode:e.data.constructor===s.AST.VariableNode&&t.variables.push(e.data.parts[0]);break;case s.AST.ElementNode:t.elements.push(e.id)}return t},{variables:[],elements:[]})},this.Beard=s}).call(this);